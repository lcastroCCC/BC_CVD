rm(list = ls())
# Loading packages
library(readxl)
library(dplyr)
# Loading dataframe
paths <- c("C:/Users/Genesis Rodriguez/Box/Sanchez-Diaz Lab/CVD and BC/Defunciones/NCHS/Procesadas/Listas/2020.xlsx",
"~/Downloads/NCHS/2020.xlsx",
":/Users/lcastro/OneDrive - Centro Comprensivo de Cancer UPR/projects_shared/BBC/Project_Dra. Carola/Data/NCHS/2020.xlsx")
# Attempt to read the file
mort <- tryCatch({
read_excel(paths[1])
}, error = function(e) {
read_excel(paths[2])
})
read_excel(paths[3])
# Loading dataframe
paths <- c("C:/Users/Genesis Rodriguez/Box/Sanchez-Diaz Lab/CVD and BC/Defunciones/NCHS/Procesadas/Listas/2020.xlsx",
"~/Downloads/NCHS/2020.xlsx",
":/Users/lcastro/OneDrive - Centro Comprensivo de Cancer UPR/projects_shared/BBC/Project_Dra. Carola/Data/NCHS/2020.xlsx")
# Attempt to read the file
mort <- tryCatch({
read_excel(paths[1])
}, error = function(e) {
read_excel(paths[2])
}, error = function(e) {
read_excel(paths[3])
})
# Loading dataframe
paths <- c("C:/Users/Genesis Rodriguez/Box/Sanchez-Diaz Lab/CVD and BC/Defunciones/NCHS/Procesadas/Listas/2020.xlsx",
"~/Downloads/NCHS/2020.xlsx",
"C:/Users/lcastro/OneDrive - Centro Comprensivo de Cancer UPR/projects_shared/BBC/Project_Dra. Carola/Data/NCHS/2020.xlsx")
# Attempt to read the file
mort <- tryCatch({
read_excel(paths[1])
}, error = function(e) {
read_excel(paths[2])
}, error = function(e) {
read_excel(paths[3])
})
View(mort)
?to_any_case()
mort <- mort %>%
rename_all(snakecase::to_any_case(case = "snake"))
View(mort)
mort <- mort %>%
rename_all(~ snakecase::to_any_case(., case = "snake"))
View(mort)
names(mort)
mort <- mort %>%
rename_all(~ snakecase::to_any_case(., case = "snake")) %>%
select(record_type,
detail_age_unit,
detail_age, # Age at death
sex,
icd_code_10_th_revision, # Underlying cause of death
`1_st_condition`,
`2_nd_condition`,
`3_rd_condition`,
marital_status,
current_data_year # Year of death
)
# Loading dataframe
paths <- c("C:/Users/Genesis Rodriguez/Box/Sanchez-Diaz Lab/CVD and BC/Defunciones/NCHS/Procesadas/Listas/2020.xlsx",
"~/Downloads/NCHS/2020.xlsx",
"C:/Users/lcastro/OneDrive - Centro Comprensivo de Cancer UPR/projects_shared/BBC/Project_Dra. Carola/Data/NCHS/2020.xlsx")
# Attempt to read the file
mort.raw <- tryCatch({
read_excel(paths[1])
}, error = function(e) {
read_excel(paths[2])
}, error = function(e) {
read_excel(paths[3])
})
# Attempt to read the file
mort.raw <- tryCatch({
read_excel(paths[1])
}, error = function(e) {
read_excel(paths[2])
}, error = function(e) {
read_excel(paths[3])
})
View(mort)
mort <- mort.raw %>%
rename_all(~ snakecase::to_any_case(., case = "snake")) %>%
select(record_type,
detail_age_unit,
detail_age, # Age at death
sex,
icd_code_10_th_revision, # Underlying cause of death
`1_st_condition`,
`2_nd_condition`,
`3_rd_condition`,
marital_status,
current_data_year # Year of death
)
View(mort)
mort <- mort.raw %>%
rename_all(~ snakecase::to_any_case(., case = "snake")) %>%
select(record_type,
detail_age_unit,
detail_age, # Age at death
sex,
icd_code_10_th_revision, # Underlying cause of death
`1_st_condition`,
`2_nd_condition`,
`3_rd_condition`,
marital_status,
current_data_year # Year of death
) %>%
mutate(across(c(icd_code_10_th_revision, `1_st_condition`, `2_nd_condition`, `3_rd_condition`), ~ sub("^(.{3})(.)", "\\1.\\2", .))) %>% # Insert a period after the third character for any 4-character string in `1_st_condition`
mutate(bcAny = ifelse(grepl("^C(50)", `1_st_condition`)|
grepl("^C(50)", `2_nd_condition`)|
grepl("^C(50)", `3_rd_condition`), TRUE, FALSE), # Diagnosis in any level
sameLead = icd_code_10_th_revision == `1_st_condition`) # Variable that checks if ICD 10 and 1st Condition are the same
View(mort)
# Underlying causes of death present
sort(unique(mort$icd_code_10_th_revision))
# Alzheimer test ----------
# Filtering using ICD 10 variable
test <- mort %>%
filter(grepl("^G(30)", icd_code_10_th_revision))
#Codes included check
table(test$icd_code_10_th_revision)
reportN <- 2627 #NVSR number of deaths
nrow(test) - reportN # Difference in N between report and my analysis
nrow(test)/reportN*100
# CVD excluding breast cancer related deaths
cvd <- mort %>%
filter(record_type == 1, # Resident of P.R.
detail_age_unit == 1, # Age in years
detail_age >= 18, # 18 years +
sex == "F", # Female
grepl("^I(00|0[1-9]|1[1,3]|2[0-9]|3[0-9]|4[0-9]|50|51|60|6[1-9]|7[0-8])", `1_st_condition`),
!grepl("^C(50[0-9])", `2_nd_condition`)|
!grepl("^C(50[0-9])", `3_rd_condition`)) %>% # Excluding BC fatalities
select(-c(record_type,
detail_age_unit,))
table(cvd$`1_st_condition`) # Confirming which ICD 10 codes show up
# Confirming correct set of ICD codes
test <- mort %>%
filter(record_type == 1, # Resident of P.R.
detail_age_unit == 1, # Age in years
detail_age >= 18, # 18 years +
sex == "F", # Female
grepl("^I(00|0[1-9]|1[1,3]|2[0-9]|3[0-9]|4[0-9]|50|51|60|6[1-9]|7[0-8])", `1_st_condition`))
cat(sort(unique(test$`1_st_condition`)), sep = " ")
test <- mort %>%
filter(record_type == 1, # Resident of P.R.
detail_age_unit == 1, # Age in years
detail_age >= 18, # 18 years +
sex == "F", # Female
!grepl("^I(00|0[1-9]|1[1,3]|2[0-9]|3[0-9]|4[0-9]|50|51|60|6[1-9]|7[0-8])", `1_st_condition`))
sort(unique(test$`1_st_condition`))
# CVD excluding all cancer related deaths
cvd <- mort %>%
filter(record_type == 1, # Resident of P.R.
detail_age_unit == 1, # Age in years
detail_age >= 18, # 18 years +
sex == "F", # Female
grepl("^I(0[0-9]|1[1,3]|2[0-9]|3[0-9]|4[0-9]|50|51|6[0-9]|7[0-8])\\b", `1_st_condition`),
!grepl("^C(50[0-9])", `2_nd_condition`)|
!grepl("^C(50[0-9])", `3_rd_condition`)) %>% # Excluding BC fatalities
select(-c(record_type,
detail_age_unit,))
# Testing
cvdtest <- mort %>%
filter(record_type == 1, # Resident of P.R.
detail_age_unit == 1, # Age in years
detail_age >= 18, # 18 years +
sex == "F", # Female
!grepl("^I(0[0-9]|1[1,3]|2[0-9]|3[0-9]|4[0-9]|50|51|6[0-9]|7[0-8])\\b", `1_st_condition`),
grepl("^I", `1_st_condition`))
table(cvd$`1_st_condition`) # Confirming which ICD 10 codes show up
# Breast cancer related deaths
bc <-   mort %>%
filter(record_type == 1, # Resident of P.R.
detail_age_unit == 1, # Age in years
detail_age >= 18, # 18 years +
sex == "F", # Female
grepl("^C(50[0-9])", `1_st_condition`)|
grepl("^C(50[0-9])", `2_nd_condition`)|
grepl("^C(50[0-9])", `3_rd_condition`)) # BC fatalities, 3 first causes
table(bc$`1_st_condition`) # Confirming which ICD 10 codes show up
View(cvd)
system("git config --global user.name")
system("git config --global user.email")
system("git config --global user.name 'lcastroCCC'")
system("git config --global user.email 'lcastro@cccupr.org'")
